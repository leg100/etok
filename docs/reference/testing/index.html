<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.83.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="E2E Tests #  To run a battery of end-to-end tests against a running kubernetes cluster:
make e2e One or more environment variables need to be specified:
 BACKUP_BUCKET - GCS bucket to backup state to during the tests  By default the tests assume you&rsquo;re running kind. For tests targeting kind you need to also specify:
 GOOGLE_APPLICATION_CREDENTIALS - Path to a file containing a service account key with credentials to read and write to $BACKUP_BUCKET  To target a GKE cluster, set ENV=gke along with:"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="E2E Tests #  To run a battery of end-to-end tests against a running kubernetes cluster:
make e2e One or more environment variables need to be specified:
 BACKUP_BUCKET - GCS bucket to backup state to during the tests  By default the tests assume you&rsquo;re running kind. For tests targeting kind you need to also specify:
 GOOGLE_APPLICATION_CREDENTIALS - Path to a file containing a service account key with credentials to read and write to $BACKUP_BUCKET  To target a GKE cluster, set ENV=gke along with:"><meta property="og:type" content="article"><meta property="og:url" content="https://docs.etok.dev/docs/reference/testing/"><meta property="article:section" content="docs"><title>Testing | Etok Documentation</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.d0e7885dc11b523c68be4468e52d512dd00179a348e470ffb6b19d88dd80fa71.css integrity="sha256-0OeIXcEbUjxovkRo5S1RLdABeaNI5HD/trGdiN2A+nE="><script defer src=/en.search.min.1ceeb1f206d6b38056411bbf5f947b5751f92d5dab6f9f798b62403d6a7309cd.js integrity="sha256-HO6x8gbWs4BWQRu/X5R7V1H5LV2rb595i2JAPWpzCc0="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/><span>Etok Documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Tutorials</span><ul><li><a href=https://docs.etok.dev/docs/tutorials/getting_started/>Getting Started</a></li></ul></li><li class=book-section-flat><span>Guides</span><ul><li><a href=https://docs.etok.dev/docs/guides/github_app/>Github App</a></li><li><a href=https://docs.etok.dev/docs/guides/state_backup/>State Backup</a></li><li><a href=https://docs.etok.dev/docs/guides/workload_identity/>Workload Identity</a></li></ul></li><li class=book-section-flat><span>Reference</span><ul><li><a href=https://docs.etok.dev/docs/reference/operator_install/>Operator Install</a></li><li><a href=https://docs.etok.dev/docs/reference/access_control/>Access Control</a></li><li><a href=https://docs.etok.dev/docs/reference/commands/>Commands</a><ul><li><a href=https://docs.etok.dev/docs/reference/commands/terraform/>Terraform</a></li><li><a href=https://docs.etok.dev/docs/reference/commands/additional/>Additional</a></li></ul></li><li><a href=https://docs.etok.dev/docs/reference/credentials/>Credentials</a></li><li><a href=https://docs.etok.dev/docs/reference/github_app/>Github App</a></li><li><a href=https://docs.etok.dev/docs/reference/restrictions/>Restrictions</a></li><li><a href=https://docs.etok.dev/docs/reference/state/>State</a></li><li><a href=https://docs.etok.dev/docs/reference/testing/ class=active>Testing</a></li></ul></li><li class=book-section-flat><span>Background</span><ul><li><a href=https://docs.etok.dev/docs/background/configuration_upload/>Configuration Upload</a></li><li><a href=https://docs.etok.dev/docs/background/performance_optimization/>Performance Optimization</a></li><li><a href=https://docs.etok.dev/docs/background/crds/>CRDs</a></li></ul></li></ul><ul><li><a href=https://github.com/leg100/etok target=_blank rel=noopener>Github</a></li><li><a href=https://join.slack.com/t/etokworkspace/shared_invite/zt-lbqgojdj-IS6aDIydMXe2X3EYf8ZRow target=_blank rel=noopener>Slack</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Testing</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#e2e-tests>E2E Tests</a><ul><li><a href=#github-app>Github App</a></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=e2e-tests>E2E Tests
<a class=anchor href=#e2e-tests>#</a></h2><p>To run a battery of end-to-end tests against a running kubernetes cluster:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>make e2e
</code></pre></div><p>One or more environment variables need to be specified:</p><ul><li><code>BACKUP_BUCKET</code> - GCS bucket to backup state to during the tests</li></ul><p>By default the tests assume you&rsquo;re running <a href=https://kind.sigs.k8s.io/>kind</a>. For tests targeting kind you need to also specify:</p><ul><li><code>GOOGLE_APPLICATION_CREDENTIALS</code> - Path to a file containing a service account key with credentials to read and write to <code>$BACKUP_BUCKET</code></li></ul><p>To target a GKE cluster, set <code>ENV=gke</code> along with:</p><ul><li><code>BACKUP_SERVICE_ACCOUNT</code> - GCP service account with permissions to read and write to <code>$BACKUP_BUCKET</code></li><li><code>GKE_IMAGE</code> - Name to assign to the docker image that is built and pushed, e.g. <code>eu.gcr.io/my-project/etok</code></li><li><code>GKE_KUBE_CONTEXT</code> - Name of the kubectl context for the GKE cluster</li></ul><p>Because the GKE tests use workload identity, you need to <a href=#workload-identity>set an IAM policy</a> on <code>$BACKUP_SERVICE_ACCOUNT</code>.</p><h3 id=github-app>Github App
<a class=anchor href=#github-app>#</a></h3><p>The e2e test of the github app is disabled by default. The following environment variables need to be set to enable the test.</p><ul><li><code>GITHUB_E2E_TEST</code> - Set to <code>true</code> to enable e2e test of github app</li><li><code>GITHUB_E2E_REPO_URL</code> - The URL of a github repo for testing, e.g. <code>git@github.com:leg100/etok-e2e.git</code></li><li><code>GITHUB_E2E_REPO_OWNER</code> - The github owner, e.g. <code>leg100</code></li><li><code>GITHUB_E2E_REPO_NAME</code> - The name of the repo, e.g. <code>etok-e2e</code></li><li><code>GITHUB_E2E_URL</code> - The URL of the deployed webhook server, e.g. <code>https://webhook.etok.dev</code></li><li><code>GITHUB_E2E_WEBHOOK_SECRET</code> - The webhook secret for authenticating to the webhook server, e.g. <code>da39a3ee5e6b4b0d3255bfef95601890afd80709</code></li><li><code>GITHUB_E2E_INSTALL_ID</code> - The github app installation ID, e.g. <code>10992</code></li><li><code>GITHUB_TOKEN</code> - A <a href=https://github.com/settings/tokens>personal access token</a> with the <code>repo</code> scope. Necessary for authenticating to the Github API for various steps of the e2e test, e.g. creating a PR, triggering an apply, etc.</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/leg100/etok/edit/master/docs/content//docs/reference/testing.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#e2e-tests>E2E Tests</a><ul><li><a href=#github-app>Github App</a></li></ul></li></ul></nav></div></aside></main></body></html>