<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.83.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Github App #  The Github app integrates Github with Etok. The app is a webhook server running on kubernetes, listening for events from Github, invoking Etok runs and reporting information back to Github, including whether the runs were successful as well as log output from terraform. The app is separate to the operator, which must also be installed.
Deployment #  The app is deployed to the kubernetes cluster using the github deploy subcommand:"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Github App #  The Github app integrates Github with Etok. The app is a webhook server running on kubernetes, listening for events from Github, invoking Etok runs and reporting information back to Github, including whether the runs were successful as well as log output from terraform. The app is separate to the operator, which must also be installed.
Deployment #  The app is deployed to the kubernetes cluster using the github deploy subcommand:"><meta property="og:type" content="article"><meta property="og:url" content="https://docs.etok.dev/docs/reference/github_app/"><meta property="article:section" content="docs"><title>Github App | Etok Documentation</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.d0e7885dc11b523c68be4468e52d512dd00179a348e470ffb6b19d88dd80fa71.css integrity="sha256-0OeIXcEbUjxovkRo5S1RLdABeaNI5HD/trGdiN2A+nE="><script defer src=/en.search.min.1ceeb1f206d6b38056411bbf5f947b5751f92d5dab6f9f798b62403d6a7309cd.js integrity="sha256-HO6x8gbWs4BWQRu/X5R7V1H5LV2rb595i2JAPWpzCc0="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/><span>Etok Documentation</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Tutorials</span><ul><li><a href=https://docs.etok.dev/docs/tutorials/getting_started/>Getting Started</a></li></ul></li><li class=book-section-flat><span>Guides</span><ul><li><a href=https://docs.etok.dev/docs/guides/github_app/>Github App</a></li><li><a href=https://docs.etok.dev/docs/guides/state_backup/>State Backup</a></li><li><a href=https://docs.etok.dev/docs/guides/workload_identity/>Workload Identity</a></li></ul></li><li class=book-section-flat><span>Reference</span><ul><li><a href=https://docs.etok.dev/docs/reference/operator_install/>Operator Install</a></li><li><a href=https://docs.etok.dev/docs/reference/access_control/>Access Control</a></li><li><a href=https://docs.etok.dev/docs/reference/commands/>Commands</a><ul><li><a href=https://docs.etok.dev/docs/reference/commands/terraform/>Terraform</a></li><li><a href=https://docs.etok.dev/docs/reference/commands/additional/>Additional</a></li></ul></li><li><a href=https://docs.etok.dev/docs/reference/credentials/>Credentials</a></li><li><a href=https://docs.etok.dev/docs/reference/github_app/ class=active>Github App</a></li><li><a href=https://docs.etok.dev/docs/reference/restrictions/>Restrictions</a></li><li><a href=https://docs.etok.dev/docs/reference/state/>State</a></li><li><a href=https://docs.etok.dev/docs/reference/testing/>Testing</a></li></ul></li><li class=book-section-flat><span>Background</span><ul><li><a href=https://docs.etok.dev/docs/background/configuration_upload/>Configuration Upload</a></li><li><a href=https://docs.etok.dev/docs/background/performance_optimization/>Performance Optimization</a></li><li><a href=https://docs.etok.dev/docs/background/crds/>CRDs</a></li></ul></li></ul><ul><li><a href=https://github.com/leg100/etok target=_blank rel=noopener>Github</a></li><li><a href=https://join.slack.com/t/etokworkspace/shared_invite/zt-lbqgojdj-IS6aDIydMXe2X3EYf8ZRow target=_blank rel=noopener>Slack</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Github App</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#deployment>Deployment</a></li><li><a href=#operation>Operation</a></li><li><a href=#notation>Notation</a></li><li><a href=#restrictions>Restrictions</a></li></ul></nav></aside></header><article class=markdown><h1 id=github-app>Github App
<a class=anchor href=#github-app>#</a></h1><p>The Github app integrates Github with Etok. The app is a webhook server running on kubernetes, listening for events from Github, invoking Etok runs and reporting information back to Github, including whether the runs were successful as well as log output from terraform. The app is separate to the <a href=https://docs.etok.dev/docs/reference/operator_install/>operator</a>, which must also be installed.</p><p><img src=/github-app-multiple-workspaces.png alt=create-1></p><h2 id=deployment>Deployment
<a class=anchor href=#deployment>#</a></h2><p>The app is deployed to the kubernetes cluster using the <code>github deploy</code> subcommand:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>etok github deploy --url <span style=color:#f92672>[</span>WEBHOOK_URL<span style=color:#f92672>]</span>
</code></pre></div><p>Note: this command also upgrades an existing deployment.</p><p>The command also handles creating the app on Github. This is a necessary step prior to the deployment to the cluster, in order to configure the webhook on your Github account and to assign permissions to the app to access your repos.</p><p>It&rsquo;ll create a secret named <code>creds</code> containing credentials for authenticating to Github. The presence of the secret determines whether the app has been created or not. So if you need to re-create the app, delete the secret and re-run the <code>github deploy</code> subcommand.</p><p>The deployment runs in a dedicated namespace, set via the namespace flag <code>--namespace</code> flag. The default is <code>github</code>.</p><h2 id=operation>Operation
<a class=anchor href=#operation>#</a></h2><p>Each commit pushed to a repository triggers terraform plans. The app looks for workspaces connected to the repository and for each connected workspace it&rsquo;ll trigger a plan.</p><blockquote class="book-hint info">For a plan, Etok executes <code>terraform init</code> followed by <code>terraform plan -out=/plans/&lt;plan></code>.</blockquote><p>If you want to re-run a plan, click the <code>Plan</code> button.</p><p>Should you want to apply the plan, click the <code>Apply</code> button, which will run <code>terraform apply</code> using the plan file produced from the plan.</p><blockquote class="book-hint info">For an apply, Etok executes <code>terraform init</code> followed by <code>terraform apply /plans/&lt;plan></code>.</blockquote><h2 id=notation>Notation
<a class=anchor href=#notation>#</a></h2><p>A completed plan is summarised with the following notation:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[NAMESPACE]/[WORKSPACE] +[ADDITIONS]/~[UPDATES]/âˆ’[DELETIONS]
</code></pre></div><p><code>[ADDITIONS]</code>, <code>[UPDATES]</code> and <code>[DELETIONS]</code> corresponds to the number of terraform resources the plan proposes to add, update, or delete respectively.</p><h2 id=restrictions>Restrictions
<a class=anchor href=#restrictions>#</a></h2><p>The visible log output is restricted to 65535 characters. To view the complete log output run the <code>kubectl logs</code> command indicated.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/leg100/etok/edit/master/docs/content//docs/reference/github_app.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#deployment>Deployment</a></li><li><a href=#operation>Operation</a></li><li><a href=#notation>Notation</a></li><li><a href=#restrictions>Restrictions</a></li></ul></nav></div></aside></main></body></html>